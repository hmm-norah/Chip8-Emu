#include "system.h"

byte builtin_font[0x50] =
{
    0xF0, 0x90, 0x90, 0x90, 0xF0,
    0x20, 0x60, 0x20, 0x20, 0x70,
    0xF0, 0x10, 0xF0, 0x80, 0xF0,
    0xF0, 0x10, 0xF0, 0x10, 0xF0,
    0x90, 0x90, 0xF0, 0x10, 0x10,
    0xF0, 0x80, 0xF0, 0x10, 0xF0,
    0xF0, 0x80, 0xF0, 0x90, 0xF0,
    0xF0, 0x10, 0x20, 0x40, 0x40,
    0xF0, 0x90, 0xF0, 0x90, 0xF0,
    0xF0, 0x90, 0xF0, 0x10, 0xF0,
    0xF0, 0x90, 0xF0, 0x90, 0x90,
    0xE0, 0x90, 0xE0, 0x90, 0xE0,
    0xF0, 0x80, 0x80, 0x80, 0xF0,
    0xE0, 0x90, 0x90, 0x90, 0xE0,
    0xF0, 0x80, 0xF0, 0x80, 0xF0,
    0xF0, 0x80, 0xF0, 0x80, 0x80
};

System::System(char * file): cpu(*memory)
{
  initialize(file);
}

System::~System()
{
}

void System::initialize(char * file)
{
  int file_size;

  ifstream in;
  in.open(file, ios::binary | ios::ate);

  file_size = in.tellg();

  byte * start = &memory[0x200]; 

  in.seekg(0, in.beg);

  in.read((char *) start, file_size + 1);

  for(int i = 0; i < 0x50; ++i)
    memory[i] = builtin_font[i];

}

void System::run()
{
  while(1)
  {
    cpu.step();
    usleep(9000);
  }
}
